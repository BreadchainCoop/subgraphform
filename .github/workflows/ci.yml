# Example: How to use the subgraphform reusable workflow
#
# This workflow demonstrates how consumer repositories should integrate
# with subgraphform. Copy this pattern to your own repository.
#
# It also serves as a live test of the reusable workflow against the
# example subgraph in this repository.

name: Example CI/CD

on:
  pull_request:
    branches: [main]
  push:
    branches: [main]

jobs:
  # This is exactly how you would call the workflow from another repository.
  # The only difference is the workflow reference:
  #   - From another repo: BreadchainCoop/subgraphform/.github/workflows/_subgraph-cicd.yml@main
  #   - From this repo: ./.github/workflows/_subgraph-cicd.yml (relative path)
  subgraph:
    uses: ./.github/workflows/_subgraph-cicd.yml
    with:
      # Required: Your subgraph name in The Graph Studio
      subgraph-name: example-subgraph

      # Optional: Path to subgraph directory (default: ".")
      working-directory: subgraph

      # Optional: Deploy settings (defaults shown)
      deploy-on-pr: false
      deploy-on-main: false  # Disabled for example - enable in your repo

      # Optional: Skip tests since example has no real tests
      run-tests: false

      # Optional: Node.js version (default: "20")
      # node-version: "20"

      # Optional: Enable GND integration tests (runs on main before deploy)
      # Requires ETHEREUM_RPC_URL secret to be set
      run-integration-tests: true

      # Optional: Path to integration test config (default: "tests/integration/config.json")
      # integration-test-config: tests/integration/config.json

      # Optional: Ethereum network for GND (default: "mainnet")
      # ethereum-network: mainnet
    secrets:
      # Required: Your Graph Studio deploy key
      # Set this in your repo's Settings > Secrets > Actions
      GRAPH_DEPLOY_KEY: ${{ secrets.GRAPH_DEPLOY_KEY }}

      # Required for integration tests: Ethereum RPC endpoint
      # Example: https://eth-mainnet.g.alchemy.com/v2/YOUR_API_KEY
      ETHEREUM_RPC_URL: ${{ secrets.ETHEREUM_RPC_URL }}
